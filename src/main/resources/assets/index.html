<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>vert.x demo</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="../webjars/adminlte/2.3.2/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../webjars/adminlte/2.3.2/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect.
    -->
    <link rel="stylesheet" href="../webjars/adminlte/2.3.2/dist/css/skins/skin-blue.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="../webjars/adminlte/2.3.2/plugins/datatables/dataTables.bootstrap.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <!-- Main Header -->
    <header class="main-header">

        <!-- Logo -->
        <a href="index.html" class="logo">
            <!-- mini logo for sidebar mini 50x50 pixels -->
            <span class="logo-mini"><b>Vert.</b>X</span>
            <!-- logo for regular state and mobile devices -->
            <span class="logo-lg"><b>Vert.x</b>DEMO</span>
        </a>

        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" role="navigation">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">导航</span>
            </a>
            <!-- Navbar Right Menu -->
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <!-- Left side column. contains the logo and sidebar -->
    <aside class="main-sidebar">

        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">

            <!-- Sidebar Menu -->
            <ul class="sidebar-menu">
                <li class="header">HEADER</li>
                <!-- Optionally, you can add icons to the links -->
                <li class="active"><a href="index.html"><i class="fa fa-link"></i> <span>demo</span></a></li>
            </ul>
            <!-- /.sidebar-menu -->
        </section>
        <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                vert.x
                <small>demo</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
                <li class="active">Here</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-xs-12">

                    <div class="box">
                        <div class="box-header">
                        </div>
                        <div class="box-body">
                            <div class="form-horizontal clearfix">
                                 <span class="col-lg-12 col-sm-12 input-group-btn">
                                      <button id="add-btn" type="button" class="btn btn-sm btn-primary">新增
                                      </button>
                                      <button id="modify-btn" type="button" class="btn btn-sm btn-primary">修改
                                      </button>
                                      <button id="remove-btn" type="button" class="btn btn-sm btn-primary">删除
                                      </button>
                                 </span>
                            </div>

                            <table class="table table-striped table-bordered bootstrap-datatable datatable">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>username</th>
                                    <th>age</th>
                                    <th>gender</th>
                                    <th>province</th>
                                </tr>
                                </thead>
                            </table>

                        </div>

                    </div>
                    <!-- /.box -->
                </div>
                <!-- /.col -->
            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <!-- Main Footer -->
    <footer class="main-footer">
        <!-- To the right -->
        <div class="pull-right hidden-xs">
            vert.x demo
        </div>
        <!-- Default to the left -->
        <strong>Copyright &copy; 2016 <a href="#">Company</a>.</strong> All rights reserved.
    </footer>

    <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 2.1.4 -->
<script src="../webjars/adminlte/2.3.2/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<!-- Bootstrap 3.3.5 -->
<script src="../webjars/adminlte/2.3.2/bootstrap/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="../webjars/adminlte/2.3.2/dist/js/app.min.js"></script>
<!-- DataTables -->
<script src="../webjars/adminlte/2.3.2/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../webjars/adminlte/2.3.2/plugins/datatables/dataTables.bootstrap.min.js"></script>
<!--bootbox-->
<script src="../webjars/bootbox/4.4.0/bootbox.js"></script>

<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. Slimscroll is required when using the
     fixed layout. -->
</body>
<script type="application/javascript">
    $(function () {
        var table = $('.datatable').dataTable({
            "pageLength": 10,
            "dom": "<'row-fluid'r>t<<'row-fluid'<'span3'i><'offset7 span2'l>><'span12 pagination-centered'p>>",
            "ordering": false,
            "searching": false,
            "processing": true,
            "serverSide": true,
            "serverMethod": "GET",
            "ajax": "../api/users",
            "columns": [
                {"data": "id"},
                {"data": "username"},
                {"data": "age"},
                {"data": "gender"},
                {"data": "province"}

            ],
            "columnDefs": [
                {
                    "render": function (data, type, row) {
                        return "<input name='table-check' type='checkbox' value='" + data + "'>";
                    },
                    "targets": 0
                },
                {
                    "render": function (data, type, row) {
                        if (data == true) {
                            return "男";
                        } else {
                            return "女";
                        }
                    },
                    "targets": 3
                }
            ]
        });

        $("#add-btn").click(function () {
            bootbox.setLocale("zh_CN");
            bootbox.dialog({
                message: '<input id="username" type="text" placeholder="姓名" class="input-sm form-control">' +
                '<input id="age" type="text" placeholder="年龄" class="input-sm form-control">' +
                '<input id="province" type="text" placeholder="省份" class="input-sm form-control">' +
                '<select id="gender" class="input-sm form-control" placeholder="选择性别">' +
                '<option value="true">男</option>' +
                '<option value="false">女</option>' +
                '</select>',
                title: "新增",
                buttons: {
                    "success": {
                        "label": "<i class='icon-ok'></i> 确定",
                        "className": "btn-sm btn-success",
                        "callback": function () {
                            $.ajax({
                                type: "POST",
                                url: "/api/user",
                                data: {
                                    username: $("#username").val(),
                                    age:$("#age").val(),
                                    province:$("#province").val(),
                                    gender:$("#gender").val()
                                },
                                dataType: "json",
                                success: function (data) {
                                    if (data.success==true) {
                                        table.fnDraw();
                                    }else{
                                        alert("保存失败");
                                    }
                                }
                            });
                        }
                    }
                }
            });
        });



        $("#modify-btn").click(function () {
            bootbox.setLocale("zh_CN");
            var temp = $(".datatable").find("input[name=table-check]:checked");
            if (temp.length !=1) {
                alert("请选择需要一条修改的记录!");
                return;
            }
            var tr = $(temp).closest('tr');
            var data=table.api().row(tr).data();

            bootbox.dialog({
                message: '<input id="username" type="text" placeholder="姓名" class="input-sm form-control" value="'+data.username+'">' +
                '<input id="age" type="text" placeholder="年龄" class="input-sm form-control" value="'+data.age+'">' +
                '<input id="province" type="text" placeholder="省份" class="input-sm form-control" value="'+data.province+'">' +
                '<select id="gender" class="input-sm form-control" placeholder="选择性别">' +
                (data.gender=="true"?'<option value="true" selected="true">男</option>':'<option value="true">男</option>') +
                (data.gender=="false"?'<option value="false" selected="true">女</option>':'<option value="false">女</option>') +
                '</select>',
                title: "修改",
                buttons: {
                    "success": {
                        "label": "<i class='icon-ok'></i> 确定",
                        "className": "btn-sm btn-success",
                        "callback": function () {
                            $.ajax({
                                type: "PUT",
                                url: "/api/user/"+data.id,
                                data: JSON.stringify({
                                    username: $("#username").val(),
                                    age:$("#age").val(),
                                    province:$("#province").val(),
                                    gender:$("#gender").val()
                                }),
                                dataType: "json",
                                success: function (data) {
                                    if (data.success==true) {
                                        table.fnDraw();
                                    }else{
                                        alert("修改失败");
                                    }
                                }
                            });
                        }
                    }
                }
            });
        });


        $("#remove-btn").click(function () {
            bootbox.setLocale("zh_CN");
            var temp = $(".datatable").find("input[name=table-check]:checked");
            if (temp.length !=1) {
                alert("请选择一条需要删除的记录!");
                return;
            }
            var tr = $(temp).closest('tr');
            var data=table.api().row(tr).data();

            bootbox.dialog({
                message: '是否删除该记录?',
                title: "删除",
                buttons: {
                    "success": {
                        "label": "<i class='icon-ok'></i> 确定",
                        "className": "btn-sm btn-success",
                        "callback": function () {
                            $.ajax({
                                type: "DELETE",
                                url: "/api/user/"+data.id,
                                dataType: "json",
                                success: function (data) {
                                    if (data.success==true) {
                                        table.fnDraw();
                                    }else{
                                        alert("删除失败");
                                    }
                                }
                            });
                        }
                    }
                }
            });
        });
    });
</script>
</html>
